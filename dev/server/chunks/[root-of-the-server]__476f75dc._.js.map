{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/asus/Desktop/LogIz/LogIz-LogIz/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || 'https://tmavagzxznmmwecbudux.supabase.co'\r\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || process.env.SUPABASE_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRtYXZhZ3p4em5tbXdlY2J1ZHV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3MDAwMzksImV4cCI6MjA3ODI3NjAzOX0.mkHQy0e3LN0hZfxEmnin5dpgycWJ6NHOp5fltrFUQF8'\r\n\r\nif (!supabaseKey) {\r\n    console.warn('⚠️ Supply a SUPABASE_KEY to use the Supabase client.')\r\n}\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseKey)\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,gFAAwC;AAC5D,MAAM,cAAc,wPAA6C,QAAQ,GAAG,CAAC,YAAY,IAAI;AAE7F;;AAIO,MAAM,WAAW,IAAA,yLAAY,EAAC,aAAa","debugId":null}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/asus/Desktop/LogIz/LogIz-LogIz/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from \"next-auth\"\r\nimport CredentialsProvider from \"next-auth/providers/credentials\"\r\nimport { supabase } from \"@/lib/supabase\"\r\nimport bcrypt from \"bcryptjs\"\r\n\r\nexport const authOptions: NextAuthOptions = {\r\n  providers: [\r\n    CredentialsProvider({\r\n      name: \"credentials\",\r\n      credentials: {\r\n        email: { label: \"Email\", type: \"email\" },\r\n        password: { label: \"Password\", type: \"password\" }\r\n      },\r\n      async authorize(credentials) {\r\n        if (!credentials?.email || !credentials?.password) {\r\n          throw new Error(\"Email and password required\")\r\n        }\r\n\r\n        // Fetch user from Supabase 'users' table\r\n        const { data: user, error } = await supabase\r\n          .from('users')\r\n          .select('*')\r\n          .eq('email', credentials.email)\r\n          .single()\r\n\r\n        if (error || !user || !user.password) {\r\n          throw new Error(\"Invalid credentials\")\r\n        }\r\n\r\n        const isPasswordValid = await bcrypt.compare(\r\n          credentials.password,\r\n          user.password\r\n        )\r\n\r\n        if (!isPasswordValid) {\r\n          throw new Error(\"Invalid credentials\")\r\n        }\r\n\r\n        return {\r\n          id: user.id,\r\n          email: user.email,\r\n          name: user.name,\r\n          role: user.role,\r\n        }\r\n      }\r\n    })\r\n  ],\r\n  session: {\r\n    strategy: \"jwt\"\r\n  },\r\n  pages: {\r\n    signIn: \"/login\",\r\n  },\r\n  callbacks: {\r\n    async jwt({ token, user }) {\r\n      if (user) {\r\n        token.id = user.id\r\n        token.role = user.role\r\n      }\r\n      return token\r\n    },\r\n    async session({ session, token }) {\r\n      if (session.user) {\r\n        session.user.id = token.id as string\r\n        session.user.role = token.role as string\r\n      }\r\n      return session\r\n    }\r\n  },\r\n  secret: process.env.NEXTAUTH_SECRET || \"development_secret_key_123\",\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAEO,MAAM,cAA+B;IAC1C,WAAW;QACT,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,MAAM,IAAI,MAAM;gBAClB;gBAEA,yCAAyC;gBACzC,MAAM,EAAE,MAAM,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,6HAAQ,CACzC,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,SAAS,YAAY,KAAK,EAC7B,MAAM;gBAET,IAAI,SAAS,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE;oBACpC,MAAM,IAAI,MAAM;gBAClB;gBAEA,MAAM,kBAAkB,MAAM,8IAAM,CAAC,OAAO,CAC1C,YAAY,QAAQ,EACpB,KAAK,QAAQ;gBAGf,IAAI,CAAC,iBAAiB;oBACpB,MAAM,IAAI,MAAM;gBAClB;gBAEA,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;oBACf,MAAM,KAAK,IAAI;gBACjB;YACF;QACF;KACD;IACD,SAAS;QACP,UAAU;IACZ;IACA,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,KAAK,IAAI;YACxB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YAChC;YACA,OAAO;QACT;IACF;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe,IAAI;AACzC","debugId":null}},
    {"offset": {"line": 195, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/asus/Desktop/LogIz/LogIz-LogIz/app/api/stats/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { createClient } from '@supabase/supabase-js'\r\nimport { getServerSession } from 'next-auth'\r\nimport { authOptions } from '@/lib/auth'\r\n\r\nexport async function GET() {\r\n  try {\r\n    // Use Service Role client to get all data (public dashboard)\r\n    const supabaseAdmin = createClient(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n      process.env.SUPABASE_SERVICE_ROLE_KEY!,\r\n      {\r\n        auth: {\r\n          autoRefreshToken: false,\r\n          persistSession: false\r\n        }\r\n      }\r\n    )\r\n\r\n    // Optional: Check session for user-specific filtering\r\n    const session = await getServerSession(authOptions)\r\n    const userId = session?.user?.id\r\n\r\n    // Get all analyses with their results (contains attack data)\r\n    let query = supabaseAdmin\r\n      .from('analyses')\r\n      .select('id, result, threat_count, high_severity, medium_severity, low_severity, analyzed_at, user_id')\r\n      .order('analyzed_at', { ascending: false })\r\n      .limit(100)\r\n\r\n    // If user is logged in, filter by user\r\n    if (userId) {\r\n      query = query.eq('user_id', userId)\r\n    }\r\n\r\n    const { data: analyses, error: analysesError } = await query\r\n\r\n    if (analysesError) throw analysesError\r\n\r\n    // Get log files count\r\n    let logsQuery = supabaseAdmin\r\n      .from('log_files')\r\n      .select('*', { count: 'exact', head: true })\r\n\r\n    if (userId) {\r\n      logsQuery = logsQuery.eq('user_id', userId)\r\n    }\r\n\r\n    const { count: totalLogs } = await logsQuery\r\n\r\n    // Aggregate stats from analyses\r\n    let totalThreats = 0\r\n    let criticalThreats = 0\r\n    let highThreats = 0\r\n    let mediumThreats = 0\r\n    const threatTypeMap = new Map<string, number>()\r\n    const severityMap = new Map<string, number>()\r\n    const recentThreats: any[] = []\r\n    const threatLocations: any[] = []\r\n    const threatsOverTimeMap = new Map<string, number>()\r\n\r\n    // Initialize last 7 days\r\n    for (let i = 6; i >= 0; i--) {\r\n      const d = new Date()\r\n      d.setDate(d.getDate() - i)\r\n      const dateStr = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })\r\n      threatsOverTimeMap.set(dateStr, 0)\r\n    }\r\n\r\n    analyses?.forEach(analysis => {\r\n      const result = analysis.result as any\r\n      if (!result) return\r\n\r\n      totalThreats += analysis.threat_count || 0\r\n\r\n      // Severity from result.summary or calculate from threats\r\n      if (result.summary) {\r\n        criticalThreats += result.summary.critical || 0\r\n        highThreats += result.summary.high || 0\r\n        mediumThreats += result.summary.medium || 0\r\n      }\r\n\r\n      // Attack Type Distribution from result\r\n      if (result.attack_type_distribution) {\r\n        Object.entries(result.attack_type_distribution).forEach(([type, count]: [string, any]) => {\r\n          threatTypeMap.set(type, (threatTypeMap.get(type) || 0) + count)\r\n        })\r\n      }\r\n\r\n      // Process threats if available\r\n      const threats = result.threats || []\r\n      threats.slice(0, 10).forEach((threat: any) => {\r\n        // Severity aggregation\r\n        const severity = threat.severity || 'UNKNOWN'\r\n        severityMap.set(severity, (severityMap.get(severity) || 0) + 1)\r\n\r\n        // Time aggregation\r\n        const dateStr = new Date(analysis.analyzed_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })\r\n        if (threatsOverTimeMap.has(dateStr)) {\r\n          threatsOverTimeMap.set(dateStr, (threatsOverTimeMap.get(dateStr) || 0) + 1)\r\n        }\r\n\r\n        // Recent threats\r\n        if (recentThreats.length < 5) {\r\n          recentThreats.push({\r\n            id: threat.id || `threat-${recentThreats.length}`,\r\n            timestamp: threat.timestamp || analysis.analyzed_at,\r\n            detectedAt: threat.timestamp || analysis.analyzed_at,\r\n            sourceIP: threat.sourceIP || threat.source_ip || '—',\r\n            destinationIP: threat.targetIP || threat.target_ip || '—',\r\n            targetIP: threat.targetIP || threat.target_ip || '—',\r\n            type: threat.type || 'Unknown',\r\n            severity: threat.severity,\r\n            description: threat.description\r\n          })\r\n        }\r\n\r\n        // Locations\r\n        if (threat.sourceLat || threat.source_lat) {\r\n          threatLocations.push({\r\n            id: threat.id,\r\n            sourceLat: threat.sourceLat || threat.source_lat,\r\n            sourceLon: threat.sourceLon || threat.source_lon,\r\n            sourceCountry: threat.sourceCountry || threat.source_country,\r\n            sourceIP: threat.sourceIP || threat.source_ip,\r\n            type: threat.type\r\n          })\r\n        }\r\n      })\r\n    })\r\n\r\n    const recentAnalyses = analyses?.length || 0\r\n    const threatsOverTime = Array.from(threatsOverTimeMap.entries()).map(([date, count]) => ({ date, count }))\r\n    const threatDistribution = Array.from(threatTypeMap.entries())\r\n      .sort((a, b) => b[1] - a[1])\r\n      .map(([name, value]) => ({ name, value }))\r\n    const severityDistribution = Array.from(severityMap.entries()).map(([name, value]) => ({ name, value }))\r\n\r\n    return NextResponse.json({\r\n      totalLogs: totalLogs || 0,\r\n      totalThreats,\r\n      criticalThreats,\r\n      highThreats,\r\n      mediumThreats,\r\n      recentAnalyses,\r\n      threatsOverTime,\r\n      threatDistribution,\r\n      severityDistribution,\r\n      recentThreats,\r\n      threatLocations: threatLocations.slice(0, 100)\r\n    })\r\n  } catch (error) {\r\n    console.error('Stats error:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch statistics', details: String(error) },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}
{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/asus/Desktop/LogIz/LogIz-LogIz/lib/notifications.ts"],"sourcesContent":["import nodemailer from 'nodemailer'\r\n\r\ninterface Threat {\r\n    type: string\r\n    severity: string\r\n    description: string\r\n    sourceIP?: string\r\n}\r\n\r\ninterface NotificationConfig {\r\n    email?: {\r\n        to: string\r\n    }\r\n    slack?: {\r\n        webhookUrl: string\r\n    }\r\n}\r\n\r\nexport async function sendNotifications(\r\n    analysisId: string,\r\n    threats: Threat[],\r\n    config: NotificationConfig\r\n) {\r\n    const criticalThreats = threats.filter(t => t.severity === 'CRITICAL')\r\n\r\n    if (criticalThreats.length === 0) {\r\n        return\r\n    }\r\n\r\n    console.log(`[Notifications] Found ${criticalThreats.length} critical threats. Sending alerts...`)\r\n\r\n    // Send Email\r\n    if (config.email && process.env.SMTP_HOST) {\r\n        try {\r\n            await sendEmail(analysisId, criticalThreats, config.email.to)\r\n        } catch (error) {\r\n            console.error('[Notifications] Failed to send email:', error)\r\n        }\r\n    }\r\n\r\n    // Send Slack\r\n    if (config.slack && process.env.SLACK_WEBHOOK_URL) {\r\n        try {\r\n            await sendSlack(analysisId, criticalThreats, process.env.SLACK_WEBHOOK_URL)\r\n        } catch (error) {\r\n            console.error('[Notifications] Failed to send Slack message:', error)\r\n        }\r\n    }\r\n}\r\n\r\nasync function sendEmail(analysisId: string, threats: Threat[], to: string) {\r\n    const transporter = nodemailer.createTransport({\r\n        host: process.env.SMTP_HOST,\r\n        port: Number(process.env.SMTP_PORT) || 587,\r\n        secure: false, // true for 465, false for other ports\r\n        auth: {\r\n            user: process.env.SMTP_USER,\r\n            pass: process.env.SMTP_PASS,\r\n        },\r\n    })\r\n\r\n    const html = `\r\n    <h1>ðŸš¨ Critical Security Alert</h1>\r\n    <p>LogIz detected <strong>${threats.length}</strong> critical threats in analysis <code>${analysisId}</code>.</p>\r\n    \r\n    <h2>Threat Details:</h2>\r\n    <ul>\r\n      ${threats.map(t => `\r\n        <li>\r\n          <strong>${t.type}</strong>: ${t.description} <br/>\r\n          Source IP: ${t.sourceIP || 'N/A'}\r\n        </li>\r\n      `).join('')}\r\n    </ul>\r\n    \r\n    <p><a href=\"${process.env.NEXTAUTH_URL}/history\">View Full Report</a></p>\r\n  `\r\n\r\n    await transporter.sendMail({\r\n        from: '\"LogIz Security\" <noreply@logiz.com>',\r\n        to,\r\n        subject: `[CRITICAL] ${threats.length} Threats Detected - LogIz`,\r\n        html,\r\n    })\r\n\r\n    console.log('[Notifications] Email sent successfully')\r\n}\r\n\r\nasync function sendSlack(analysisId: string, threats: Threat[], webhookUrl: string) {\r\n    const blocks = [\r\n        {\r\n            type: \"header\",\r\n            text: {\r\n                type: \"plain_text\",\r\n                text: \"ðŸš¨ Critical Security Alert\",\r\n                emoji: true\r\n            }\r\n        },\r\n        {\r\n            type: \"section\",\r\n            text: {\r\n                type: \"mrkdwn\",\r\n                text: `LogIz detected *${threats.length}* critical threats in analysis \\`${analysisId}\\`.`\r\n            }\r\n        },\r\n        {\r\n            type: \"divider\"\r\n        },\r\n        ...threats.slice(0, 5).map(t => ({\r\n            type: \"section\",\r\n            text: {\r\n                type: \"mrkdwn\",\r\n                text: `*${t.type}*\\n${t.description}\\nSource IP: \\`${t.sourceIP || 'N/A'}\\``\r\n            }\r\n        })),\r\n        {\r\n            type: \"section\",\r\n            text: {\r\n                type: \"mrkdwn\",\r\n                text: `<${process.env.NEXTAUTH_URL}/history|View Full Report>`\r\n            }\r\n        }\r\n    ]\r\n\r\n    const response = await fetch(webhookUrl, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ blocks }),\r\n    })\r\n\r\n    if (!response.ok) {\r\n        throw new Error(`Slack API error: ${response.statusText}`)\r\n    }\r\n\r\n    console.log('[Notifications] Slack message sent successfully')\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}